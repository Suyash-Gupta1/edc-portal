{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ALG/Downloads/edc-nit-durgapur-landing-page%20%282%29/lib/db.ts"],"sourcesContent":["import mongoose from 'mongoose';\n\n// User provided URI as fallback.\n// IMPORTANT: You must replace <db_password> with your actual MongoDB password.\nconst FALLBACK_URI = \"mongodb+srv://SuyashGupta:<db_password>@cluster0.dgobo2d.mongodb.net/?appName=Cluster0\";\nconst MONGODB_URI = process.env.MONGODB_URI || FALLBACK_URI;\n\n// Global interface to prevent TS errors on global.mongoose\ndeclare global {\n  var mongoose: any;\n}\n\nlet cached = (globalThis as any).mongoose;\n\nif (!cached) {\n  cached = (globalThis as any).mongoose = { conn: null, promise: null };\n}\n\nasync function dbConnect() {\n  if (!MONGODB_URI) {\n    throw new Error('Please define the MONGODB_URI environment variable inside .env.local');\n  }\n\n  // Check if the placeholder is still present\n  if (MONGODB_URI.includes('<db_password>')) {\n    throw new Error('Invalid MongoDB URI: Please replace <db_password> with your actual database password in lib/db.ts');\n  }\n\n  if (cached.conn) {\n    return cached.conn;\n  }\n\n  if (!cached.promise) {\n    const opts = {\n      bufferCommands: false,\n    };\n\n    cached.promise = mongoose.connect(MONGODB_URI, opts).then((mongoose) => {\n      return mongoose;\n    });\n  }\n  \n  try {\n    cached.conn = await cached.promise;\n  } catch (e) {\n    cached.promise = null;\n    throw e;\n  }\n\n  return cached.conn;\n}\n\nexport default dbConnect;"],"names":[],"mappings":";;;;AAAA;;AAEA,iCAAiC;AACjC,+EAA+E;AAC/E,MAAM,eAAe;AACrB,MAAM,cAAc,QAAQ,GAAG,CAAC,WAAW,IAAI;AAO/C,IAAI,SAAS,AAAC,WAAmB,QAAQ;AAEzC,IAAI,CAAC,QAAQ;IACX,SAAS,AAAC,WAAmB,QAAQ,GAAG;QAAE,MAAM;QAAM,SAAS;IAAK;AACtE;AAEA,eAAe;IACb;;IAIA,4CAA4C;IAC5C,IAAI,YAAY,QAAQ,CAAC,kBAAkB;QACzC,MAAM,IAAI,MAAM;IAClB;IAEA,IAAI,OAAO,IAAI,EAAE;QACf,OAAO,OAAO,IAAI;IACpB;IAEA,IAAI,CAAC,OAAO,OAAO,EAAE;QACnB,MAAM,OAAO;YACX,gBAAgB;QAClB;QAEA,OAAO,OAAO,GAAG,oHAAQ,CAAC,OAAO,CAAC,aAAa,MAAM,IAAI,CAAC,CAAC;YACzD,OAAO;QACT;IACF;IAEA,IAAI;QACF,OAAO,IAAI,GAAG,MAAM,OAAO,OAAO;IACpC,EAAE,OAAO,GAAG;QACV,OAAO,OAAO,GAAG;QACjB,MAAM;IACR;IAEA,OAAO,OAAO,IAAI;AACpB;uCAEe"}},
    {"offset": {"line": 94, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ALG/Downloads/edc-nit-durgapur-landing-page%20%282%29/models/User.ts"],"sourcesContent":["import mongoose, { Schema, Document, Model } from 'mongoose';\n\nexport interface IUser extends Document {\n  username: string;\n  email: string;\n  password: string;\n  domain: string;\n  round: number;\n  hasSelection: boolean;\n  createdAt: Date;\n}\n\nconst UserSchema = new Schema<IUser>({\n  username: {\n    type: String,\n    required: [true, 'Please provide a username'],\n    unique: true,\n  },\n  email: {\n    type: String,\n    required: [true, 'Please provide an email'],\n    unique: true,\n  },\n  password: {\n    type: String,\n    required: [true, 'Please provide a password'],\n  },\n  domain: {\n    type: String,\n    required: [true, 'Please select a domain'],\n  },\n  // Tracks the selection round: 0 (Applied), 1-3 (Interview Rounds), 4 (Selected)\n  round: {\n    type: Number,\n    default: 0, \n  },\n  hasSelection: {\n    type: Boolean,\n    default: false,\n  },\n  createdAt: {\n    type: Date,\n    default: Date.now,\n  },\n});\n\n// Explicitly type the model to avoid Union type errors in Next.js API routes\nconst User: Model<IUser> = mongoose.models.User || mongoose.model<IUser>('User', UserSchema);\n\nexport default User;"],"names":[],"mappings":";;;;AAAA;;AAYA,MAAM,aAAa,IAAI,mHAAM,CAAQ;IACnC,UAAU;QACR,MAAM;QACN,UAAU;YAAC;YAAM;SAA4B;QAC7C,QAAQ;IACV;IACA,OAAO;QACL,MAAM;QACN,UAAU;YAAC;YAAM;SAA0B;QAC3C,QAAQ;IACV;IACA,UAAU;QACR,MAAM;QACN,UAAU;YAAC;YAAM;SAA4B;IAC/C;IACA,QAAQ;QACN,MAAM;QACN,UAAU;YAAC;YAAM;SAAyB;IAC5C;IACA,gFAAgF;IAChF,OAAO;QACL,MAAM;QACN,SAAS;IACX;IACA,cAAc;QACZ,MAAM;QACN,SAAS;IACX;IACA,WAAW;QACT,MAAM;QACN,SAAS,KAAK,GAAG;IACnB;AACF;AAEA,6EAA6E;AAC7E,MAAM,OAAqB,oHAAQ,CAAC,MAAM,CAAC,IAAI,IAAI,oHAAQ,CAAC,KAAK,CAAQ,QAAQ;uCAElE"}},
    {"offset": {"line": 248, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ALG/Downloads/edc-nit-durgapur-landing-page%20%282%29/lib/mail.ts"],"sourcesContent":["import nodemailer from 'nodemailer';\r\n\r\n// Configure these in your .env.local file\r\n// EMAIL_USER=your-email@gmail.com\r\n// EMAIL_PASS=your-app-specific-password\r\nconst transporter = nodemailer.createTransport({\r\n  service: 'gmail',\r\n  auth: {\r\n    user: process.env.EMAIL_USER,\r\n    pass: process.env.EMAIL_PASS,\r\n  },\r\n});\r\n\r\nexport const sendStatusEmail = async (\r\n  email: string,\r\n  username: string,\r\n  round: number,\r\n  domain: string\r\n) => {\r\n  // If credentials aren't set, log to console (for development/demo)\r\n  if (!process.env.EMAIL_USER || !process.env.EMAIL_PASS) {\r\n    console.log(`[Mock Email] To: ${email} | Subject: Round ${round} Update | User: ${username}`);\r\n    return;\r\n  }\r\n\r\n  let subject = '';\r\n  let htmlContent = '';\r\n\r\n  const commonStyle = `\r\n    font-family: sans-serif; \r\n    color: #333; \r\n    line-height: 1.6;\r\n    max-width: 600px;\r\n    margin: 0 auto;\r\n    padding: 20px;\r\n    border: 1px solid #eee;\r\n    border-radius: 8px;\r\n  `;\r\n\r\n  const header = `\r\n    <div style=\"background-color: #000; padding: 15px; text-align: center; border-radius: 8px 8px 0 0;\">\r\n        <h2 style=\"color: #ccff00; margin: 0;\">EDC Recruitment</h2>\r\n    </div>\r\n  `;\r\n\r\n  switch (round) {\r\n    case 1:\r\n      subject = 'Update: EDC Recruitment Round 1';\r\n      htmlContent = `\r\n        ${header}\r\n        <div style=\"padding: 20px;\">\r\n            <h3>Hello ${username},</h3>\r\n            <p>Congratulations! You have cleared the initial screening for the <strong>${domain}</strong> domain.</p>\r\n            <p>You have been shortlisted for <strong>Round 1</strong> (Personal Interview). Details regarding the schedule will be shared shortly.</p>\r\n            <p>Best Regards,<br/>EDC Team</p>\r\n        </div>\r\n      `;\r\n      break;\r\n    case 2:\r\n      subject = 'Update: Advanced to Round 2';\r\n      htmlContent = `\r\n        ${header}\r\n        <div style=\"padding: 20px;\">\r\n            <h3>Great Job, ${username}!</h3>\r\n            <p>We are pleased to inform you that you have successfully cleared Round 1.</p>\r\n            <p>You are now advancing to <strong>Round 2</strong> (Technical/Task Round) for the <strong>${domain}</strong> domain.</p>\r\n            <p>Keep up the momentum!</p>\r\n            <p>Best Regards,<br/>EDC Team</p>\r\n        </div>\r\n      `;\r\n      break;\r\n    case 3:\r\n      subject = 'Update: Final Interview Round';\r\n      htmlContent = `\r\n        ${header}\r\n        <div style=\"padding: 20px;\">\r\n            <h3>Almost There, ${username}!</h3>\r\n            <p>Your performance has been impressive. You have been selected for the <strong>Final Interview (Round 3)</strong>.</p>\r\n            <p>This is the last step in the recruitment process for the <strong>${domain}</strong> domain.</p>\r\n            <p>Best Regards,<br/>EDC Team</p>\r\n        </div>\r\n      `;\r\n      break;\r\n    case 4:\r\n      subject = 'Congratulations! Welcome to EDC';\r\n      htmlContent = `\r\n        ${header}\r\n        <div style=\"padding: 20px; border-left: 4px solid #ccff00;\">\r\n            <h2 style=\"color: #000;\">Welcome to the Team!</h2>\r\n            <p>Dear ${username},</p>\r\n            <p>We are thrilled to invite you to join the <strong>Entrepreneurship Development Cell</strong>.</p>\r\n            <p>You have been officially selected for the <strong>${domain}</strong> domain.</p>\r\n            <p>Get ready to innovate, ideate, and incubate!</p>\r\n            <p>Cheers,<br/>EDC NIT Durgapur</p>\r\n        </div>\r\n      `;\r\n      break;\r\n    default:\r\n      return; // Do not send email for demotions or round 0\r\n  }\r\n\r\n  try {\r\n    await transporter.sendMail({\r\n      from: `\"EDC Recruitment\" <${process.env.EMAIL_USER}>`,\r\n      to: email,\r\n      subject: subject,\r\n      html: `<div style=\"${commonStyle}\">${htmlContent}</div>`,\r\n    });\r\n    console.log(`Email sent to ${email} for Round ${round}`);\r\n  } catch (error) {\r\n    console.error('Error sending email:', error);\r\n    // Don't throw error here to prevent blocking the API response\r\n  }\r\n};\r\n"],"names":[],"mappings":";;;;AAAA;;AAEA,0CAA0C;AAC1C,kCAAkC;AAClC,wCAAwC;AACxC,MAAM,cAAc,4JAAU,CAAC,eAAe,CAAC;IAC7C,SAAS;IACT,MAAM;QACJ,MAAM,QAAQ,GAAG,CAAC,UAAU;QAC5B,MAAM,QAAQ,GAAG,CAAC,UAAU;IAC9B;AACF;AAEO,MAAM,kBAAkB,OAC7B,OACA,UACA,OACA;IAEA,mEAAmE;IACnE,IAAI,CAAC,QAAQ,GAAG,CAAC,UAAU,IAAI,CAAC,QAAQ,GAAG,CAAC,UAAU,EAAE;QACtD,QAAQ,GAAG,CAAC,CAAC,iBAAiB,EAAE,MAAM,kBAAkB,EAAE,MAAM,gBAAgB,EAAE,UAAU;QAC5F;IACF;IAEA,IAAI,UAAU;IACd,IAAI,cAAc;IAElB,MAAM,cAAc,CAAC;;;;;;;;;EASrB,CAAC;IAED,MAAM,SAAS,CAAC;;;;EAIhB,CAAC;IAED,OAAQ;QACN,KAAK;YACH,UAAU;YACV,cAAc,CAAC;QACb,EAAE,OAAO;;sBAEK,EAAE,SAAS;uFACsD,EAAE,OAAO;;;;MAI1F,CAAC;YACD;QACF,KAAK;YACH,UAAU;YACV,cAAc,CAAC;QACb,EAAE,OAAO;;2BAEU,EAAE,SAAS;;wGAEkE,EAAE,OAAO;;;;MAI3G,CAAC;YACD;QACF,KAAK;YACH,UAAU;YACV,cAAc,CAAC;QACb,EAAE,OAAO;;8BAEa,EAAE,SAAS;;gFAEuC,EAAE,OAAO;;;MAGnF,CAAC;YACD;QACF,KAAK;YACH,UAAU;YACV,cAAc,CAAC;QACb,EAAE,OAAO;;;oBAGG,EAAE,SAAS;;iEAEkC,EAAE,OAAO;;;;MAIpE,CAAC;YACD;QACF;YACE,QAAQ,6CAA6C;IACzD;IAEA,IAAI;QACF,MAAM,YAAY,QAAQ,CAAC;YACzB,MAAM,CAAC,mBAAmB,EAAE,QAAQ,GAAG,CAAC,UAAU,CAAC,CAAC,CAAC;YACrD,IAAI;YACJ,SAAS;YACT,MAAM,CAAC,YAAY,EAAE,YAAY,EAAE,EAAE,YAAY,MAAM,CAAC;QAC1D;QACA,QAAQ,GAAG,CAAC,CAAC,cAAc,EAAE,MAAM,WAAW,EAAE,OAAO;IACzD,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,wBAAwB;IACtC,8DAA8D;IAChE;AACF"}},
    {"offset": {"line": 359, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ALG/Downloads/edc-nit-durgapur-landing-page%20%282%29/app/api/admin/update/route.ts"],"sourcesContent":["import dbConnect from '@/lib/db';\nimport User from '@/models/User';\nimport { NextResponse } from 'next/server';\nimport { sendStatusEmail } from '@/lib/mail';\n\nconst ADMIN_KEY = \"EDC_ADMIN_2024\";\n\nexport async function POST(req: Request) {\n  await dbConnect();\n\n  const apiKey = req.headers.get('admin-key');\n\n  if (apiKey !== ADMIN_KEY) {\n    return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n  }\n\n  try {\n    const body = await req.json();\n    const { userId, round } = body;\n\n    if (!userId || typeof round !== 'number') {\n      return NextResponse.json({ error: 'Invalid data' }, { status: 400 });\n    }\n\n    // 1. Fetch current user state BEFORE update to check if this is a promotion\n    const currentUser = await User.findById(userId);\n    \n    if (!currentUser) {\n        return NextResponse.json({ error: 'User not found' }, { status: 404 });\n    }\n\n    // Determine hasSelection based on round (Round 4 = Selected)\n    const hasSelection = round >= 4;\n\n    // 2. Update the user\n    const updatedUser = await User.findByIdAndUpdate(\n      userId,\n      { round: round, hasSelection: hasSelection },\n      { new: true }\n    );\n\n    // 3. Send Email ONLY if the round has increased (Promotion)\n    // We await this to ensure the serverless function doesn't terminate before sending\n    if (round > currentUser.round) {\n        console.log(`[Email Trigger] Promoting ${updatedUser.username} to Round ${round}`);\n        try {\n            await sendStatusEmail(\n                updatedUser.email, \n                updatedUser.username, \n                round, \n                updatedUser.domain\n            );\n            console.log(`[Email Success] Sent to ${updatedUser.email}`);\n        } catch (emailError) {\n            console.error(\"[Email Failure]\", emailError);\n            // Non-blocking error for the API response, but logged.\n        }\n    }\n\n    return NextResponse.json({ success: true, user: updatedUser });\n  } catch (error: any) {\n    return NextResponse.json({ error: error.message }, { status: 500 });\n  }\n}"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;;;;;AAEA,MAAM,YAAY;AAEX,eAAe,KAAK,GAAY;IACrC,MAAM,IAAA,sHAAS;IAEf,MAAM,SAAS,IAAI,OAAO,CAAC,GAAG,CAAC;IAE/B,IAAI,WAAW,WAAW;QACxB,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAe,GAAG;YAAE,QAAQ;QAAI;IACpE;IAEA,IAAI;QACF,MAAM,OAAO,MAAM,IAAI,IAAI;QAC3B,MAAM,EAAE,MAAM,EAAE,KAAK,EAAE,GAAG;QAE1B,IAAI,CAAC,UAAU,OAAO,UAAU,UAAU;YACxC,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAe,GAAG;gBAAE,QAAQ;YAAI;QACpE;QAEA,4EAA4E;QAC5E,MAAM,cAAc,MAAM,2HAAI,CAAC,QAAQ,CAAC;QAExC,IAAI,CAAC,aAAa;YACd,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAiB,GAAG;gBAAE,QAAQ;YAAI;QACxE;QAEA,6DAA6D;QAC7D,MAAM,eAAe,SAAS;QAE9B,qBAAqB;QACrB,MAAM,cAAc,MAAM,2HAAI,CAAC,iBAAiB,CAC9C,QACA;YAAE,OAAO;YAAO,cAAc;QAAa,GAC3C;YAAE,KAAK;QAAK;QAGd,4DAA4D;QAC5D,mFAAmF;QACnF,IAAI,QAAQ,YAAY,KAAK,EAAE;YAC3B,QAAQ,GAAG,CAAC,CAAC,0BAA0B,EAAE,YAAY,QAAQ,CAAC,UAAU,EAAE,OAAO;YACjF,IAAI;gBACA,MAAM,IAAA,gIAAe,EACjB,YAAY,KAAK,EACjB,YAAY,QAAQ,EACpB,OACA,YAAY,MAAM;gBAEtB,QAAQ,GAAG,CAAC,CAAC,wBAAwB,EAAE,YAAY,KAAK,EAAE;YAC9D,EAAE,OAAO,YAAY;gBACjB,QAAQ,KAAK,CAAC,mBAAmB;YACjC,uDAAuD;YAC3D;QACJ;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,SAAS;YAAM,MAAM;QAAY;IAC9D,EAAE,OAAO,OAAY;QACnB,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO,MAAM,OAAO;QAAC,GAAG;YAAE,QAAQ;QAAI;IACnE;AACF"}}]
}