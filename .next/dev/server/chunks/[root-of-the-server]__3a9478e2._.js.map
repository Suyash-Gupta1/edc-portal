{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ALG/Downloads/edc-nit-durgapur-landing-page%20%282%29/proxy.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\r\nimport type { NextRequest } from 'next/server';\r\nimport { jwtVerify } from 'jose';\r\n\r\n\r\nconst JWT_SECRET = process.env.JWT_SECRET || \"default_secret\";\r\nconst ADMIN_KEY = \"EDC_ADMIN_2024\"; \r\n\r\n\r\nconst WINDOW_MS = 60 * 1000; \r\nconst AUTH_LIMIT = 5;        \r\nconst GENERIC_LIMIT = 100;   \r\n\r\n\r\nconst rateLimitMap = new Map<string, { count: number; lastReset: number }>();\r\n\r\nexport const config = {\r\n  \r\n  matcher: [\r\n    '/((?!_next/static|_next/image|favicon.ico).*)',\r\n  ],\r\n};\r\n\r\nexport async function proxy(request: NextRequest) {\r\n  const ip = request.headers.get('x-forwarded-for') || '127.0.0.1';\r\n  const { pathname } = request.nextUrl;\r\n  const response = NextResponse.next();\r\n\r\n  \r\n  response.headers.set('X-Content-Type-Options', 'nosniff');\r\n  response.headers.set('X-Frame-Options', 'DENY');\r\n\r\n  \r\n  if (pathname.startsWith('/api')) {\r\n    const limit = pathname.startsWith('/api/auth') ? AUTH_LIMIT : GENERIC_LIMIT;\r\n    const currentTime = Date.now();\r\n    const record = rateLimitMap.get(ip) || { count: 0, lastReset: currentTime };\r\n\r\n    if (currentTime - record.lastReset > WINDOW_MS) {\r\n      record.count = 0;\r\n      record.lastReset = currentTime;\r\n    }\r\n\r\n    if (record.count >= limit) {\r\n      return NextResponse.json(\r\n        { error: 'Too many requests. Please try again later.' },\r\n        { status: 429 }\r\n      );\r\n    }\r\n\r\n    record.count += 1;\r\n    rateLimitMap.set(ip, record);\r\n    \r\n    \r\n    if (pathname.startsWith('/api/admin')) {\r\n        const apiKey = request.headers.get('admin-key');\r\n        if (apiKey !== ADMIN_KEY) {\r\n            return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\r\n        }\r\n    }\r\n    \r\n    return response; \r\n  }\r\n\r\n  \r\n  const token = request.cookies.get(\"token\")?.value;\r\n  \r\n  \r\n  if (pathname.startsWith('/admin')) {\r\n    if (!token) return NextResponse.redirect(new URL(\"/\", request.url));\r\n\r\n    try {\r\n      \r\n      const secret = new TextEncoder().encode(JWT_SECRET);\r\n      const { payload } = await jwtVerify(token, secret);\r\n\r\n      if (!payload.isAdmin) {\r\n        \r\n        return NextResponse.redirect(new URL(\"/status\", request.url));\r\n      }\r\n      return NextResponse.next(); \r\n\r\n    } catch (err) {\r\n     \r\n      return NextResponse.redirect(new URL(\"/\", request.url));\r\n    }\r\n  }\r\n\r\n  const protectedPaths = ['/status', '/results', '/profile'];\r\n  \r\n  if (protectedPaths.some((p) => pathname.startsWith(p))) {\r\n    if (!token) {\r\n      return NextResponse.redirect(new URL(\"/\", request.url));\r\n    }\r\n    \r\n  }\r\n\r\n  return NextResponse.next();\r\n}"],"names":[],"mappings":";;;;;;AAAA;AAEA;;;AAGA,MAAM,aAAa,QAAQ,GAAG,CAAC,UAAU,IAAI;AAC7C,MAAM,YAAY;AAGlB,MAAM,YAAY,KAAK;AACvB,MAAM,aAAa;AACnB,MAAM,gBAAgB;AAGtB,MAAM,eAAe,IAAI;AAElB,MAAM,SAAS;IAEpB,SAAS;QACP;KACD;AACH;AAEO,eAAe,MAAM,OAAoB;IAC9C,MAAM,KAAK,QAAQ,OAAO,CAAC,GAAG,CAAC,sBAAsB;IACrD,MAAM,EAAE,QAAQ,EAAE,GAAG,QAAQ,OAAO;IACpC,MAAM,WAAW,8IAAY,CAAC,IAAI;IAGlC,SAAS,OAAO,CAAC,GAAG,CAAC,0BAA0B;IAC/C,SAAS,OAAO,CAAC,GAAG,CAAC,mBAAmB;IAGxC,IAAI,SAAS,UAAU,CAAC,SAAS;QAC/B,MAAM,QAAQ,SAAS,UAAU,CAAC,eAAe,aAAa;QAC9D,MAAM,cAAc,KAAK,GAAG;QAC5B,MAAM,SAAS,aAAa,GAAG,CAAC,OAAO;YAAE,OAAO;YAAG,WAAW;QAAY;QAE1E,IAAI,cAAc,OAAO,SAAS,GAAG,WAAW;YAC9C,OAAO,KAAK,GAAG;YACf,OAAO,SAAS,GAAG;QACrB;QAEA,IAAI,OAAO,KAAK,IAAI,OAAO;YACzB,OAAO,8IAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAA6C,GACtD;gBAAE,QAAQ;YAAI;QAElB;QAEA,OAAO,KAAK,IAAI;QAChB,aAAa,GAAG,CAAC,IAAI;QAGrB,IAAI,SAAS,UAAU,CAAC,eAAe;YACnC,MAAM,SAAS,QAAQ,OAAO,CAAC,GAAG,CAAC;YACnC,IAAI,WAAW,WAAW;gBACtB,OAAO,8IAAY,CAAC,IAAI,CAAC;oBAAE,OAAO;gBAAe,GAAG;oBAAE,QAAQ;gBAAI;YACtE;QACJ;QAEA,OAAO;IACT;IAGA,MAAM,QAAQ,QAAQ,OAAO,CAAC,GAAG,CAAC,UAAU;IAG5C,IAAI,SAAS,UAAU,CAAC,WAAW;QACjC,IAAI,CAAC,OAAO,OAAO,8IAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,KAAK,QAAQ,GAAG;QAEjE,IAAI;YAEF,MAAM,SAAS,IAAI,cAAc,MAAM,CAAC;YACxC,MAAM,EAAE,OAAO,EAAE,GAAG,MAAM,IAAA,oKAAS,EAAC,OAAO;YAE3C,IAAI,CAAC,QAAQ,OAAO,EAAE;gBAEpB,OAAO,8IAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,WAAW,QAAQ,GAAG;YAC7D;YACA,OAAO,8IAAY,CAAC,IAAI;QAE1B,EAAE,OAAO,KAAK;YAEZ,OAAO,8IAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,KAAK,QAAQ,GAAG;QACvD;IACF;IAEA,MAAM,iBAAiB;QAAC;QAAW;QAAY;KAAW;IAE1D,IAAI,eAAe,IAAI,CAAC,CAAC,IAAM,SAAS,UAAU,CAAC,KAAK;QACtD,IAAI,CAAC,OAAO;YACV,OAAO,8IAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,KAAK,QAAQ,GAAG;QACvD;IAEF;IAEA,OAAO,8IAAY,CAAC,IAAI;AAC1B"}}]
}