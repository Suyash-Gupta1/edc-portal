{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/middleware.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\r\nimport type { NextRequest } from 'next/server';\r\n\r\n// Configuration\r\nconst ADMIN_KEY = \"EDC_ADMIN_2024\";\r\nconst WINDOW_MS = 60 * 1000; // 1 minute\r\nconst AUTH_LIMIT = 5; // Strict limit for auth routes\r\nconst GENERIC_LIMIT = 100; // Generous limit for data fetching\r\n\r\n// In-memory store for Rate Limiting\r\n// Note: In a distributed serverless env (like Vercel), this map is specific to the container instance.\r\n// For enterprise scale, use Redis (e.g., Upstash). For this landing page, this is sufficient.\r\nconst rateLimitMap = new Map<string, { count: number; lastReset: number }>();\r\n\r\nexport function middleware(request: NextRequest) {\r\n  const ip = request.headers.get('x-forwarded-for') || '127.0.0.1';\r\n  const { pathname } = request.nextUrl;\r\n  \r\n  // Prepare response (we will attach headers to this)\r\n  const response = NextResponse.next();\r\n\r\n  // --- 1. Security Headers ---\r\n  // Apply standard security headers to all API responses\r\n  response.headers.set('X-Content-Type-Options', 'nosniff');\r\n  response.headers.set('X-Frame-Options', 'DENY');\r\n  response.headers.set('Referrer-Policy', 'strict-origin-when-cross-origin');\r\n  response.headers.set('X-DNS-Prefetch-Control', 'on');\r\n\r\n  // We only care about protecting /api routes here\r\n  if (!pathname.startsWith('/api')) {\r\n    return response;\r\n  }\r\n\r\n  // --- 2. Admin Route Protection ---\r\n  // Intercepts admin requests before they reach the handler\r\n  if (pathname.startsWith('/api/admin')) {\r\n    const apiKey = request.headers.get('admin-key');\r\n    if (apiKey !== ADMIN_KEY) {\r\n      return NextResponse.json(\r\n        { error: 'Unauthorized: Invalid or Missing Admin Key' }, \r\n        { status: 401 }\r\n      );\r\n    }\r\n  }\r\n\r\n  // --- 3. Rate Limiting Strategy ---\r\n  // Stricter limits for Auth, looser for general data\r\n  const limit = pathname.startsWith('/api/auth') ? AUTH_LIMIT : GENERIC_LIMIT;\r\n  \r\n  const currentTime = Date.now();\r\n  const record = rateLimitMap.get(ip) || { count: 0, lastReset: currentTime };\r\n\r\n  // Reset window if time has passed\r\n  if (currentTime - record.lastReset > WINDOW_MS) {\r\n    record.count = 0;\r\n    record.lastReset = currentTime;\r\n  }\r\n\r\n  // Check if limit exceeded\r\n  if (record.count >= limit) {\r\n    return NextResponse.json(\r\n      { error: 'Too many requests. Please try again later.' },\r\n      { status: 429 }\r\n    );\r\n  }\r\n\r\n  // Increment and update\r\n  record.count += 1;\r\n  rateLimitMap.set(ip, record);\r\n\r\n  // Return the response with security headers attached\r\n  return response;\r\n}\r\n\r\n// Only run middleware on API routes to avoid overhead on static assets/pages\r\nexport const config = {\r\n  matcher: '/api/:path*',\r\n};\r\n"],"names":[],"mappings":";;;;;;AAAA;AAAA;;AAGA,gBAAgB;AAChB,MAAM,YAAY;AAClB,MAAM,YAAY,KAAK,MAAM,WAAW;AACxC,MAAM,aAAa,GAAG,+BAA+B;AACrD,MAAM,gBAAgB,KAAK,mCAAmC;AAE9D,oCAAoC;AACpC,uGAAuG;AACvG,8FAA8F;AAC9F,MAAM,eAAe,IAAI;AAElB,SAAS,WAAW,OAAoB;IAC7C,MAAM,KAAK,QAAQ,OAAO,CAAC,GAAG,CAAC,sBAAsB;IACrD,MAAM,EAAE,QAAQ,EAAE,GAAG,QAAQ,OAAO;IAEpC,oDAAoD;IACpD,MAAM,WAAW,gMAAY,CAAC,IAAI;IAElC,8BAA8B;IAC9B,uDAAuD;IACvD,SAAS,OAAO,CAAC,GAAG,CAAC,0BAA0B;IAC/C,SAAS,OAAO,CAAC,GAAG,CAAC,mBAAmB;IACxC,SAAS,OAAO,CAAC,GAAG,CAAC,mBAAmB;IACxC,SAAS,OAAO,CAAC,GAAG,CAAC,0BAA0B;IAE/C,iDAAiD;IACjD,IAAI,CAAC,SAAS,UAAU,CAAC,SAAS;QAChC,OAAO;IACT;IAEA,oCAAoC;IACpC,0DAA0D;IAC1D,IAAI,SAAS,UAAU,CAAC,eAAe;QACrC,MAAM,SAAS,QAAQ,OAAO,CAAC,GAAG,CAAC;QACnC,IAAI,WAAW,WAAW;YACxB,OAAO,gMAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAA6C,GACtD;gBAAE,QAAQ;YAAI;QAElB;IACF;IAEA,oCAAoC;IACpC,oDAAoD;IACpD,MAAM,QAAQ,SAAS,UAAU,CAAC,eAAe,aAAa;IAE9D,MAAM,cAAc,KAAK,GAAG;IAC5B,MAAM,SAAS,aAAa,GAAG,CAAC,OAAO;QAAE,OAAO;QAAG,WAAW;IAAY;IAE1E,kCAAkC;IAClC,IAAI,cAAc,OAAO,SAAS,GAAG,WAAW;QAC9C,OAAO,KAAK,GAAG;QACf,OAAO,SAAS,GAAG;IACrB;IAEA,0BAA0B;IAC1B,IAAI,OAAO,KAAK,IAAI,OAAO;QACzB,OAAO,gMAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAA6C,GACtD;YAAE,QAAQ;QAAI;IAElB;IAEA,uBAAuB;IACvB,OAAO,KAAK,IAAI;IAChB,aAAa,GAAG,CAAC,IAAI;IAErB,qDAAqD;IACrD,OAAO;AACT;AAGO,MAAM,SAAS;IACpB,SAAS;AACX"}}]
}